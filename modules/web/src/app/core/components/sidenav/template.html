<!--
Copyright 2020 The Kubermatic Kubernetes Platform contributors.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<div class="km-sidenav"
     fxLayout="column"
     [ngClass]="isSidenavCollapsed() ? 'collapse-sidenav' : ''">
  <div [matTooltip]="getTooltip(view.Overview)"
       [ngClass]="!getMenuItemClass(view.Overview) && 'km-disabled'"
       class="menu-item">
    <a id="km-nav-item-overview"
       fxLayoutAlign=" center"
       [routerLink]="getRouterLink(view.Overview)"
       [ngClass]="getLinkClass(view.Overview)">
      <i class="km-icon-projects-card"></i>
      <span *ngIf="!isSidenavCollapsed()">Project Overview</span>
    </a>
  </div>
  <ng-container *ngIf="!isSidenavCollapsed()">
    <km-side-nav-field label="Resources"
                       icon="km-icon-cluster">
      <div class="sub-menu-item"
           [ngClass]="{'active': checkUrl(view.Clusters), 'km-disabled': !getMenuItemClass(view.Clusters)}">
        <a id="km-nav-item-clusters"
           fxLayoutAlign=" center"
           [routerLink]="getRouterLink(view.Clusters)">
          <span>Clusters</span>
        </a>
      </div>

      <div class="sub-menu-item"
           [ngClass]="{'active': checkUrl(view.ExternalClusters), 'km-disabled': !getMenuItemClass(view.ExternalClusters)}">
        <a id="km-nav-item-external-clusters"
           fxLayoutAlign=" center"
           [routerLink]="getRouterLink(view.ExternalClusters)">
          <span>Extrnal Clusters</span>
        </a>
      </div>
    </km-side-nav-field>
  </ng-container>

  <ng-container *ngIf="isSidenavCollapsed()">
    <button class="km-icon-cluster collapesd-button"
            (click)="menuTrigger.openMenu()"
            [matTooltip]="getTooltip(view.Clusters)">
      <div #menuTrigger="matMenuTrigger"
           [matMenuTriggerFor]="menu"
           [ngClass]="getLinkClass(view.Clusters)">
      </div>
    </button>
    <mat-menu #menu="matMenu">
      <mat-label class="menu-label">Resources</mat-label>
      <hr />
      <a mat-menu-item
         fxLayoutAlign=" center"
         [routerLink]="getRouterLink(view.Clusters)"
         class="collapsed-sub-menu-item"
         [ngClass]="getLinkClass(view.Clusters)">
        <span>Clusters</span>
      </a>

      <a mat-menu-item
         fxLayoutAlign=" center"
         [routerLink]="getRouterLink(view.ExternalClusters)"
         class="collapsed-sub-menu-item"
         [ngClass]="getLinkClass(view.ExternalClusters)">
        <span>Extrnal Clusters</span>
      </a>
    </mat-menu>
  </ng-container>

  <div [matTooltip]="getTooltip(view.ClusterTemplates)"
       [ngClass]="!getMenuItemClass(view.Overview) && 'km-disabled'"
       class="menu-item">
    <a id="km-nav-item-cluster-templates"
       fxLayoutAlign=" center"
       [routerLink]="getRouterLink(view.ClusterTemplates)"
       [ngClass]="getLinkClass(view.ClusterTemplates)">
      <i class="km-icon-cluster-template"></i>
      <span *ngIf="!isSidenavCollapsed()">Cluster Templates</span>
    </a>
  </div>
  <ng-container *ngIf="!isSidenavCollapsed()">
    <km-side-nav-field label="etcd Backups"
                       icon="km-icon-backup">
      <div [ngClass]="{'active': checkUrl(view.Backups), 'km-disabled': !getMenuItemClass(view.Backups)}"
           class="sub-menu-item">
        <a id="km-nav-item-backups"
           fxLayoutAlign=" center"
           [routerLink]="getRouterLink(view.Backups)"
           [ngClass]="getLinkClass(view.Backups)">
          <span>Automatic Backups</span>
        </a>
      </div>

      <div [matTooltip]="getTooltip(view.Backups)"
           [ngClass]="{'active': checkUrl(view.Snapshots), 'km-disabled': !getMenuItemClass(view.Snapshots)}"
           class="sub-menu-item">
        <a fxLayoutAlign=" center"
           [routerLink]="getRouterLink(view.Snapshots)"
           [ngClass]="getLinkClass(view.Snapshots)">
          <span>Snapshots</span>
        </a>
      </div>

      <div [matTooltip]="getTooltip(view.Backups)"
           [ngClass]="{'active': checkUrl(view.Restores), 'km-disabled': !getMenuItemClass(view.Restores)}"
           class="sub-menu-item">
        <a fxLayoutAlign=" center"
           [routerLink]="getRouterLink(view.Restores)"
           [ngClass]="getLinkClass(view.Restores)">
          <span>Restores</span>
        </a>
      </div>
    </km-side-nav-field>
  </ng-container>

  <ng-container *ngIf="isSidenavCollapsed()">
    <button (click)="menuTrigger.openMenu()"
            class="km-icon-backup collapesd-button"
            [ngClass]="getLinkClass(view.Backups)"
            [matTooltip]="getTooltip(view.Backups)">
      <div #menuTrigger="matMenuTrigger"
           [matMenuTriggerFor]="menu"></div>
    </button>

    <mat-menu #menu="matMenu">
      <mat-label class="menu-label">etcd Backups</mat-label>
      <hr />
      <a mat-menu-item
         fxLayoutAlign=" center"
         [routerLink]="getRouterLink(view.Backups)"
         class="collapsed-sub-menu-item"
         [ngClass]="getLinkClass(view.Backups)">
        <span>Automatic Backups</span>
      </a>

      <a mat-menu-item
         fxLayoutAlign=" center"
         [routerLink]="getRouterLink(view.Snapshots)"
         class="collapsed-sub-menu-item"
         [ngClass]="getLinkClass(view.Snapshots)">
        <span>Snapshots</span>
      </a>

      <a mat-menu-item
         fxLayoutAlign=" center"
         [routerLink]="getRouterLink(view.Restores)"
         class="collapsed-sub-menu-item"
         [ngClass]="getLinkClass(view.Restores)">
        <span>Restores</span>
      </a>
    </mat-menu>
  </ng-container>

  <ng-container *ngIf="!isSidenavCollapsed()">
    <km-side-nav-field label="Access"
                       icon="km-icon-key">
      <div [ngClass]="{'active': checkUrl(view.SSHKeys), 'km-disabled': !getMenuItemClass(view.SSHKeys)}"
           class="sub-menu-item">
        <a id="km-nav-item-sshkeys"
           fxLayoutAlign=" center"
           [routerLink]="getRouterLink(view.SSHKeys)"
           [ngClass]="getLinkClass(view.SSHKeys)">
          <span>SSH Keys</span>
        </a>
      </div>

      <div [ngClass]="{'active': checkUrl(view.Members), 'km-disabled': !getMenuItemClass(view.Members)}"
           class="sub-menu-item">
        <a id="km-nav-item-members"
           fxLayoutAlign=" center"
           [routerLink]="getRouterLink(view.Members)"
           [ngClass]="getLinkClass(view.Members)">
          <span>Members</span>
        </a>
      </div>

      <div [ngClass]="{'active': checkUrl(view.Groups), 'km-disabled': !getMenuItemClass(view.Groups)}"
           class="sub-menu-item">
        <a fxLayoutAlign=" center"
           [routerLink]="getRouterLink(view.Groups)"
           [ngClass]="getLinkClass(view.Groups)">
          <span>Groups</span>
        </a>
      </div>

      <div [ngClass]="{'active': checkUrl(view.ServiceAccounts), 'km-disabled': !getMenuItemClass(view.ServiceAccounts)}"
           class="sub-menu-item">
        <a id="km-nav-item-service-accounts"
           fxLayoutAlign=" center"
           [routerLink]="getRouterLink(view.ServiceAccounts)"
           [ngClass]="getLinkClass(view.ServiceAccounts)">
          <span>Service Accounts</span></a>
      </div>
    </km-side-nav-field>
  </ng-container>

  <ng-container *ngIf="isSidenavCollapsed()">
    <button (click)="menuTrigger.openMenu()"
            class="km-icon-key collapesd-button"
            [matTooltip]="getTooltip(view.Backups)">
      <div #menuTrigger="matMenuTrigger"
           [matMenuTriggerFor]="menu"></div>
    </button>
    <mat-menu #menu="matMenu">
      <mat-label class="menu-label">Access</mat-label>
      <hr />
      <a mat-menu-item
         fxLayoutAlign=" center"
         [routerLink]="getRouterLink(view.SSHKeys)"
         class="collapsed-sub-menu-item"
         [ngClass]="getLinkClass(view.SSHKeys)">
        <span>SSH Keys</span>
      </a>

      <a mat-menu-item
         fxLayoutAlign=" center"
         [routerLink]="getRouterLink(view.Members)"
         class="collapsed-sub-menu-item"
         [ngClass]="getLinkClass(view.Members)">
        <span>Members</span>
      </a>

      <a mat-menu-item
         fxLayoutAlign=" center"
         [routerLink]="getRouterLink(view.Groups)"
         class="collapsed-sub-menu-item"
         [ngClass]="getLinkClass(view.Groups)">
        <span>Groups</span>
      </a>

      <a mat-menu-item
         fxLayoutAlign=" center"
         [routerLink]="getRouterLink(view.ServiceAccounts)"
         class="collapsed-sub-menu-item"
         [ngClass]="getLinkClass(view.ServiceAccounts)">
        <span>Service Accounts</span></a>
    </mat-menu>
  </ng-container>

  <ng-container *ngIf="(customLinks | kmLinkLocation: 'Default') as filtered">
    <mat-divider *ngIf="filtered.length > 0"></mat-divider>

    <div *ngFor="let link of filtered"
         class="menu-item">
      <a [href]="link.url"
         fxLayoutAlign=" center"
         target="_blank"
         rel="noopener">
        <i [ngStyle]="getCustomLinkIconStyle(link)"></i>
        <span *ngIf="!isSidenavCollapsed()">{{link.label}}</span>
      </a>
    </div>
  </ng-container>

  <div fxFlex></div>

  <div [matTooltip]="getTooltip(view.Projects)"
       class="menu-item">
    <a id="km-nav-item-projects"
       fxLayoutAlign="center center"
       routerLink="/projects">
      <i class="km-icon-mask km-icon-back"></i>
      <span *ngIf="!isSidenavCollapsed()">back to projects</span>
    </a>
  </div>
</div>
