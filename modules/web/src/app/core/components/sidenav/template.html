<!--
Copyright 2020 The Kubermatic Kubernetes Platform contributors.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->
<div class="km-sidenav"
     [ngClass]="{'collapse-sidenav': isSidenavCollapsed}">
  <div class="sidenav-inner-container"
       fxLayout="column">

    <div [matTooltip]="getTooltip(view.Overview)"
         [ngClass]="!isDisabledField(view.Overview) && 'km-disabled'"
         class="menu-item">
      <a id="km-nav-item-overview"
         fxLayoutAlign=" center"
         fxLayoutGap="20px"
         [routerLink]="getRouterLink(view.Overview)"
         [ngClass]="getLinkClass(view.Overview)">
        <i class="km-icon-projects-card"></i>
        @if (!isSidenavCollapsed) {
        <span>Project Overview</span>
        }
      </a>
    </div>
    <km-side-nav-field [label]="projectSidenavSections.Resources"
                       icon="km-icon-cluster"
                       [isSidenavCollapsed]="isSidenavCollapsed">
      @if (!isSidenavCollapsed) {
      <div class="sub-menu-item"
           [ngClass]="{'active': checkUrl(view.Clusters), 'km-disabled': !isDisabledField(view.Clusters)}">
        <a id="km-nav-item-clusters"
           fxLayoutAlign=" center"
           [routerLink]="getRouterLink(view.Clusters)">
          <span>Clusters</span>
        </a>
      </div>
      @if (adminSettings.enableExternalClusterImport) {
      <div class="sub-menu-item"
           [ngClass]="{'active': checkUrl(view.ExternalClusters), 'km-disabled': !isDisabledField(view.ExternalClusters)}">
        <a id="km-nav-item-external-clusters"
           fxLayoutAlign=" center"
           [routerLink]="getRouterLink(view.ExternalClusters)">
          <span>External Clusters</span>
        </a>
      </div>
      }
      @if (adminSettings.enableExternalClusterImport) {
      <div class="sub-menu-item"
           [ngClass]="{'active': checkUrl(view.KubeOneClusters), 'km-disabled': !isDisabledField(view.KubeOneClusters)}">
        <a id="km-nav-item-kubeone-clusters"
           fxLayoutAlign=" center"
           [routerLink]="getRouterLink(view.KubeOneClusters)">
          <span>KubeOne Clusters</span>
        </a>
      </div>
      }
      }

      @if (isSidenavCollapsed) {
      <a fxLayoutAlign=" center"
         [routerLink]="getRouterLink(view.Clusters)"
         class="collapsed-sub-menu-item"
         [ngClass]="{'active': checkUrl(view.Clusters), 'km-disabled': !isDisabledField(view.Clusters)}">
        <span>Clusters</span>
      </a>
      @if (adminSettings.enableExternalClusterImport) {
      <a fxLayoutAlign=" center"
         [routerLink]="getRouterLink(view.ExternalClusters)"
         class="collapsed-sub-menu-item"
         [ngClass]="{'active': checkUrl(view.ExternalClusters), 'km-disabled': !isDisabledField(view.ExternalClusters)}">
        <span>External Clusters</span>
      </a>
      }
      @if (adminSettings.enableExternalClusterImport) {
      <a fxLayoutAlign=" center"
         [routerLink]="getRouterLink(view.KubeOneClusters)"
         class="collapsed-sub-menu-item"
         [ngClass]="{'active': checkUrl(view.KubeOneClusters), 'km-disabled': !isDisabledField(view.KubeOneClusters)}">
        <span>KubeOne Clusters</span>
      </a>
      }
      }
    </km-side-nav-field>


    <div [matTooltip]="getTooltip(view.ClusterTemplates)"
         [ngClass]="{'km-disabled': !isDisabledField(view.Overview)}"
         class="menu-item">
      <a id="km-nav-item-cluster-templates"
         fxLayoutAlign=" center"
         fxLayoutGap="20px"
         [routerLink]="getRouterLink(view.ClusterTemplates)"
         [ngClass]="getLinkClass(view.ClusterTemplates)">
        <i class="km-icon-cluster-template"></i>
        @if (!isSidenavCollapsed) {
        <span>Cluster Templates</span>
        }
      </a>
    </div>
    @if (adminSettings.enableEtcdBackup) {
    <km-side-nav-field [label]="projectSidenavSections.Backups"
                       icon="km-icon-backup"
                       [isSidenavCollapsed]="isSidenavCollapsed">
      @if (!isSidenavCollapsed) {
      <div [ngClass]="{'active': checkUrl(view.Backups), 'km-disabled': !isDisabledField(view.Backups)}"
           class="sub-menu-item">
        <a id="km-nav-item-backups"
           fxLayoutAlign=" center"
           [routerLink]="getRouterLink(view.Backups)">
          <span>Automatic Backups</span>
        </a>
      </div>
      <div [matTooltip]="getTooltip(view.Backups)"
           [ngClass]="{'active': checkUrl(view.Snapshots), 'km-disabled': !isDisabledField(view.Snapshots)}"
           class="sub-menu-item">
        <a fxLayoutAlign=" center"
           [routerLink]="getRouterLink(view.Snapshots)">
          <span>Snapshots</span>
        </a>
      </div>
      <div [matTooltip]="getTooltip(view.Backups)"
           [ngClass]="{'active': checkUrl(view.Restores), 'km-disabled': !isDisabledField(view.Restores)}"
           class="sub-menu-item">
        <a fxLayoutAlign=" center"
           [routerLink]="getRouterLink(view.Restores)">
          <span>Restores</span>
        </a>
      </div>
      }
      @if (isSidenavCollapsed) {
      <a fxLayoutAlign=" center"
         [routerLink]="getRouterLink(view.Backups)"
         class="collapsed-sub-menu-item"
         [ngClass]="{'active': checkUrl(view.Backups), 'km-disabled': !isDisabledField(view.Backups)}">
        <span>Automatic Backups</span>
      </a>
      <a fxLayoutAlign=" center"
         [routerLink]="getRouterLink(view.Snapshots)"
         class="collapsed-sub-menu-item"
         [ngClass]="{'active': checkUrl(view.Snapshots), 'km-disabled': !isDisabledField(view.Snapshots)}">
        <span>Snapshots</span>
      </a>
      <a fxLayoutAlign=" center"
         [routerLink]="getRouterLink(view.Restores)"
         class="collapsed-sub-menu-item"
         [ngClass]="{'active': checkUrl(view.Restores), 'km-disabled': !isDisabledField(view.Restores)}">
        <span>Restores</span>
      </a>
      }
    </km-side-nav-field>
    }

    @if (isEnterpriseEdition && adminSettings.enableClusterBackups) {
    <km-side-nav-field [label]="projectSidenavSections.ClusterBackups"
                       icon="km-icon-cluster-backup"
                       [isSidenavCollapsed]="isSidenavCollapsed">
      @if (!isSidenavCollapsed) {
      <div [ngClass]="{'active': checkUrl(view.ClusterBackup), 'km-disabled': !isDisabledField(view.ClusterBackup)}"
           class="sub-menu-item">
        <a fxLayoutAlign=" center"
           [routerLink]="getRouterLink(view.ClusterBackup)">
          <span>Backups</span>
        </a>
      </div>
      <div [ngClass]="{'active': checkUrl(view.ClusterSchedule), 'km-disabled': !isDisabledField(view.ClusterSchedule)}"
           class="sub-menu-item">
        <a fxLayoutAlign=" center"
           [routerLink]="getRouterLink(view.ClusterSchedule)">
          <span>Schedules</span>
        </a>
      </div>
      <div [ngClass]="{'active': checkUrl(view.ClusterRestore), 'km-disabled': !isDisabledField(view.ClusterRestore)}"
           class="sub-menu-item">
        <a fxLayoutAlign=" center"
           [routerLink]="getRouterLink(view.ClusterRestore)">
          <span>Restores</span>
        </a>
      </div>
      <div [ngClass]="{'active': checkUrl(view.BackupStorageLocation), 'km-disabled': !isDisabledField(view.BackupStorageLocation)}"
           class="sub-menu-item">
        <a fxLayoutAlign=" center"
           [routerLink]="getRouterLink(view.BackupStorageLocation)">
          <span>Storage Locations</span>
        </a>
      </div>
      }
      @if (isSidenavCollapsed) {
      <a fxLayoutAlign=" center"
         [routerLink]="getRouterLink(view.ClusterBackup)"
         class="collapsed-sub-menu-item"
         [ngClass]="{'active': checkUrl(view.ClusterBackup), 'km-disabled': !isDisabledField(view.ClusterBackup)}">
        <span>Backups</span>
      </a>
      <a fxLayoutAlign=" center"
         [routerLink]="getRouterLink(view.ClusterSchedule)"
         class="collapsed-sub-menu-item"
         [ngClass]="{'active': checkUrl(view.ClusterSchedule), 'km-disabled': !isDisabledField(view.ClusterSchedule)}">
        <span>Schedules</span>
      </a>
      <a fxLayoutAlign=" center"
         [routerLink]="getRouterLink(view.ClusterRestore)"
         class="collapsed-sub-menu-item"
         [ngClass]="{'active': checkUrl(view.ClusterRestore), 'km-disabled': !isDisabledField(view.ClusterRestore)}">
        <span>Restores</span>
      </a>
      <a fxLayoutAlign=" center"
         [routerLink]="getRouterLink(view.BackupStorageLocation)"
         class="collapsed-sub-menu-item"
         [ngClass]="{'active': checkUrl(view.BackupStorageLocation), 'km-disabled': !isDisabledField(view.BackupStorageLocation)}">
        <span>Storage Locations</span>
      </a>
      }
    </km-side-nav-field>
    }
    @if (isEnterpriseEdition) {
    <div [matTooltip]="getTooltip(view.KyvernoPolicies)"
         [ngClass]="{'km-disabled': !isDisabledField(view.KyvernoPolicies)}"
         class="menu-item">
      <a id="km-nav-item-kyverno-policies"
         fxLayoutAlign=" center"
         fxLayoutGap="20px"
         [routerLink]="getRouterLink(view.KyvernoPolicies)"
         [ngClass]="getLinkClass(view.KyvernoPolicies)">
        <i class="km-icon-kyverno"></i>
        @if (!isSidenavCollapsed) {
        <span>{{ViewDisplayName.KyvernoPolicies}}</span>
        }
      </a>
    </div>
    }

    <km-side-nav-field [label]="projectSidenavSections.Access"
                       icon="km-icon-key"
                       [isSidenavCollapsed]="isSidenavCollapsed"
                       [lastItem]=true>
      @if (!isSidenavCollapsed) {
      @if (isUserSshKeyEnabled) {
      <div [ngClass]="{'active': checkUrl(view.SSHKeys), 'km-disabled': !isDisabledField(view.SSHKeys)}"
           class="sub-menu-item">
        <a id="km-nav-item-sshkeys"
           fxLayoutAlign=" center"
           [routerLink]="getRouterLink(view.SSHKeys)">
          <span>SSH Keys</span>
        </a>
      </div>
      }
      <div [ngClass]="{'active': checkUrl(view.Members), 'km-disabled': !isDisabledField(view.Members)}"
           class="sub-menu-item">
        <a id="km-nav-item-members"
           fxLayoutAlign=" center"
           [routerLink]="getRouterLink(view.Members)">
          <span>Members</span>
        </a>
      </div>
      @if (isEnterpriseEdition) {
      <div [ngClass]="{'active': checkUrl(view.Groups), 'km-disabled': !isDisabledField(view.Groups)}"
           class="sub-menu-item">
        <a fxLayoutAlign=" center"
           [routerLink]="getRouterLink(view.Groups)">
          <span>Groups</span>
        </a>
      </div>
      }
      <div [ngClass]="{'active': checkUrl(view.ServiceAccounts), 'km-disabled': !isDisabledField(view.ServiceAccounts)}"
           class="sub-menu-item">
        <a id="km-nav-item-service-accounts"
           fxLayoutAlign=" center"
           [routerLink]="getRouterLink(view.ServiceAccounts)">
          <span>Service Accounts</span></a>
      </div>
      }

      @if (isSidenavCollapsed) {
      @if (isUserSshKeyEnabled) {
      <a fxLayoutAlign=" center"
         [routerLink]="getRouterLink(view.SSHKeys)"
         class="collapsed-sub-menu-item"
         [ngClass]="{'active': checkUrl(view.SSHKeys), 'km-disabled': !isDisabledField(view.SSHKeys)}">
        <span>SSH Keys</span>
      </a>
      }
      <a fxLayoutAlign=" center"
         [routerLink]="getRouterLink(view.Members)"
         class="collapsed-sub-menu-item"
         [ngClass]="{'active': checkUrl(view.Members), 'km-disabled': !isDisabledField(view.Members)}">
        <span>Members</span>
      </a>
      @if (isEnterpriseEdition) {
      <a fxLayoutAlign=" center"
         [routerLink]="getRouterLink(view.Groups)"
         class="collapsed-sub-menu-item"
         [ngClass]="{'active': checkUrl(view.Groups), 'km-disabled': !isDisabledField(view.Groups)}">
        <span>Groups</span>
      </a>
      }
      <a fxLayoutAlign=" center"
         [routerLink]="getRouterLink(view.ServiceAccounts)"
         class="collapsed-sub-menu-item"
         [ngClass]="{'active': checkUrl(view.ServiceAccounts), 'km-disabled': !isDisabledField(view.ServiceAccounts)}">
        <span>Service Accounts</span></a>
      }

    </km-side-nav-field>

    @if ((adminSettings.customLinks| kmLinkLocation: 'Default'); as filtered) {
    @if (filtered.length > 0) {
    <mat-divider />
    }
    @for (link of filtered; track link) {
    <div class="menu-item">
      <a [href]="link.url"
         fxLayoutAlign=" center"
         fxLayoutGap="20px"
         target="_blank"
         [matTooltip]="link.label"
         [matTooltipDisabled]="!isSidenavCollapsed"
         rel="noopener">
        <i [ngStyle]="getCustomLinkIconStyle(link)"></i>
        @if (!isSidenavCollapsed) {
        <span>{{link.label}}</span>
        }
      </a>
    </div>
    }
    }

    <div fxFlex></div>

    <div [matTooltip]="getTooltip(view.Projects)"
         class="go-back"
         [ngClass]="{'go-back-collapsed': isSidenavCollapsed}">
      <a id="km-nav-item-projects"
         fxLayoutAlign="center center"
         routerLink="/projects">
        <i class="km-icon-mask km-icon-back"></i>
        @if (!isSidenavCollapsed) {
        <span>back to projects</span>
        }
      </a>
    </div>
  </div>
</div>
