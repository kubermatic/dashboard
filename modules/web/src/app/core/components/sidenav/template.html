<!--
Copyright 2020 The Kubermatic Kubernetes Platform contributors.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->
<div class="km-sidenav"
     [ngClass]="{'collapse-sidenav': isSidenavCollapsed}">
  <div class="sidenav-inner-container"
       fxLayout="column">

    <div [matTooltip]="getTooltip(view.Overview)"
         [ngClass]="!isDisabledField(view.Overview) && 'km-disabled'"
         class="menu-item">
      <a id="km-nav-item-overview"
         fxLayoutAlign=" center"
         fxLayoutGap="20px"
         [routerLink]="getRouterLink(view.Overview)"
         [ngClass]="getLinkClass(view.Overview)">
        <i class="km-icon-projects-card"></i>
        <span *ngIf="!isSidenavCollapsed">Project Overview</span>
      </a>
    </div>
    <km-side-nav-field [label]="projectSidenavSections.Resources"
                       icon="km-icon-cluster"
                       [isSidenavCollapsed]="isSidenavCollapsed">
      <ng-container *ngIf="!isSidenavCollapsed">

        <div class="sub-menu-item"
             [ngClass]="{'active': checkUrl(view.Clusters), 'km-disabled': !isDisabledField(view.Clusters)}">
          <a id="km-nav-item-clusters"
             fxLayoutAlign=" center"
             [routerLink]="getRouterLink(view.Clusters)">
            <span>Clusters</span>
          </a>
        </div>

        <div *ngIf="adminSettings.enableExternalClusterImport"
             class="sub-menu-item"
             [ngClass]="{'active': checkUrl(view.ExternalClusters), 'km-disabled': !isDisabledField(view.ExternalClusters)}">
          <a id="km-nav-item-external-clusters"
             fxLayoutAlign=" center"
             [routerLink]="getRouterLink(view.ExternalClusters)">
            <span>External Clusters</span>
          </a>
        </div>

        <div *ngIf="adminSettings.enableExternalClusterImport"
             class="sub-menu-item"
             [ngClass]="{'active': checkUrl(view.KubeOneClusters), 'km-disabled': !isDisabledField(view.KubeOneClusters)}">
          <a id="km-nav-item-kubeone-clusters"
             fxLayoutAlign=" center"
             [routerLink]="getRouterLink(view.KubeOneClusters)">
            <span>KubeOne Clusters</span>
          </a>
        </div>

      </ng-container>

      <ng-container *ngIf="isSidenavCollapsed">


        <a fxLayoutAlign=" center"
           [routerLink]="getRouterLink(view.Clusters)"
           class="collapsed-sub-menu-item"
           [ngClass]="{'active': checkUrl(view.Clusters), 'km-disabled': !isDisabledField(view.Clusters)}">
          <span>Clusters</span>
        </a>

        <a *ngIf="adminSettings.enableExternalClusterImport"
           fxLayoutAlign=" center"
           [routerLink]="getRouterLink(view.ExternalClusters)"
           class="collapsed-sub-menu-item"
           [ngClass]="{'active': checkUrl(view.ExternalClusters), 'km-disabled': !isDisabledField(view.ExternalClusters)}">
          <span>External Clusters</span>
        </a>

        <a *ngIf="adminSettings.enableExternalClusterImport"
           fxLayoutAlign=" center"
           [routerLink]="getRouterLink(view.KubeOneClusters)"
           class="collapsed-sub-menu-item"
           [ngClass]="{'active': checkUrl(view.KubeOneClusters), 'km-disabled': !isDisabledField(view.KubeOneClusters)}">
          <span>KubeOne Clusters</span>
        </a>
      </ng-container>
    </km-side-nav-field>


    <div [matTooltip]="getTooltip(view.ClusterTemplates)"
         [ngClass]="{'km-disabled': !isDisabledField(view.Overview)}"
         class="menu-item">
      <a id="km-nav-item-cluster-templates"
         fxLayoutAlign=" center"
         fxLayoutGap="20px"
         [routerLink]="getRouterLink(view.ClusterTemplates)"
         [ngClass]="getLinkClass(view.ClusterTemplates)">
        <i class="km-icon-cluster-template"></i>
        <span *ngIf="!isSidenavCollapsed">Cluster Templates</span>
      </a>
    </div>
    <km-side-nav-field *ngIf="adminSettings.enableEtcdBackup"
                       [label]="projectSidenavSections.Backups"
                       icon="km-icon-backup"
                       [isSidenavCollapsed]="isSidenavCollapsed">
      <ng-container *ngIf="!isSidenavCollapsed">
        <div [ngClass]="{'active': checkUrl(view.Backups), 'km-disabled': !isDisabledField(view.Backups)}"
             class="sub-menu-item">
          <a id="km-nav-item-backups"
             fxLayoutAlign=" center"
             [routerLink]="getRouterLink(view.Backups)">
            <span>Automatic Backups</span>
          </a>
        </div>

        <div [matTooltip]="getTooltip(view.Backups)"
             [ngClass]="{'active': checkUrl(view.Snapshots), 'km-disabled': !isDisabledField(view.Snapshots)}"
             class="sub-menu-item">
          <a fxLayoutAlign=" center"
             [routerLink]="getRouterLink(view.Snapshots)">
            <span>Snapshots</span>
          </a>
        </div>

        <div [matTooltip]="getTooltip(view.Backups)"
             [ngClass]="{'active': checkUrl(view.Restores), 'km-disabled': !isDisabledField(view.Restores)}"
             class="sub-menu-item">
          <a fxLayoutAlign=" center"
             [routerLink]="getRouterLink(view.Restores)">
            <span>Restores</span>
          </a>
        </div>
      </ng-container>


      <ng-container *ngIf="isSidenavCollapsed">

        <a fxLayoutAlign=" center"
           [routerLink]="getRouterLink(view.Backups)"
           class="collapsed-sub-menu-item"
           [ngClass]="{'active': checkUrl(view.Backups), 'km-disabled': !isDisabledField(view.Backups)}">
          <span>Automatic Backups</span>
        </a>

        <a fxLayoutAlign=" center"
           [routerLink]="getRouterLink(view.Snapshots)"
           class="collapsed-sub-menu-item"
           [ngClass]="{'active': checkUrl(view.Snapshots), 'km-disabled': !isDisabledField(view.Snapshots)}">
          <span>Snapshots</span>
        </a>

        <a fxLayoutAlign=" center"
           [routerLink]="getRouterLink(view.Restores)"
           class="collapsed-sub-menu-item"
           [ngClass]="{'active': checkUrl(view.Restores), 'km-disabled': !isDisabledField(view.Restores)}">
          <span>Restores</span>
        </a>
      </ng-container>
    </km-side-nav-field>

    <km-side-nav-field *ngIf="isEnterpriseEdition && adminSettings.enableClusterBackups"
                       [label]="projectSidenavSections.ClusterBackups"
                       icon="km-icon-cluster-backup"
                       [isSidenavCollapsed]="isSidenavCollapsed">
      <ng-container *ngIf="!isSidenavCollapsed">
        <div [ngClass]="{'active': checkUrl(view.ClusterBackup), 'km-disabled': !isDisabledField(view.ClusterBackup)}"
             class="sub-menu-item">
          <a fxLayoutAlign=" center"
             [routerLink]="getRouterLink(view.ClusterBackup)">
            <span>Backups</span>
          </a>
        </div>
        <div [ngClass]="{'active': checkUrl(view.ClusterSchedule), 'km-disabled': !isDisabledField(view.ClusterSchedule)}"
             class="sub-menu-item">
          <a fxLayoutAlign=" center"
             [routerLink]="getRouterLink(view.ClusterSchedule)">
            <span>Schedules</span>
          </a>
        </div>
        <div [ngClass]="{'active': checkUrl(view.ClusterRestore), 'km-disabled': !isDisabledField(view.ClusterRestore)}"
             class="sub-menu-item">
          <a fxLayoutAlign=" center"
             [routerLink]="getRouterLink(view.ClusterRestore)">
            <span>Restores</span>
          </a>
        </div>
        <div [ngClass]="{'active': checkUrl(view.BackupStorageLocation), 'km-disabled': !isDisabledField(view.BackupStorageLocation)}"
             class="sub-menu-item">
          <a fxLayoutAlign=" center"
             [routerLink]="getRouterLink(view.BackupStorageLocation)">
            <span>Storage Locations</span>
          </a>
        </div>
      </ng-container>
      <ng-container *ngIf="isSidenavCollapsed">
        <a fxLayoutAlign=" center"
           [routerLink]="getRouterLink(view.ClusterBackup)"
           class="collapsed-sub-menu-item"
           [ngClass]="{'active': checkUrl(view.ClusterBackup), 'km-disabled': !isDisabledField(view.ClusterBackup)}">
          <span>Backups</span>
        </a>
        <a fxLayoutAlign=" center"
           [routerLink]="getRouterLink(view.ClusterSchedule)"
           class="collapsed-sub-menu-item"
           [ngClass]="{'active': checkUrl(view.ClusterSchedule), 'km-disabled': !isDisabledField(view.ClusterSchedule)}">
          <span>Schedules</span>
        </a>
        <a fxLayoutAlign=" center"
           [routerLink]="getRouterLink(view.ClusterRestore)"
           class="collapsed-sub-menu-item"
           [ngClass]="{'active': checkUrl(view.ClusterRestore), 'km-disabled': !isDisabledField(view.ClusterRestore)}">
          <span>Restores</span>
        </a>
        <a fxLayoutAlign=" center"
           [routerLink]="getRouterLink(view.BackupStorageLocation)"
           class="collapsed-sub-menu-item"
           [ngClass]="{'active': checkUrl(view.BackupStorageLocation), 'km-disabled': !isDisabledField(view.BackupStorageLocation)}">
          <span>Storage Locations</span>
        </a>
      </ng-container>
    </km-side-nav-field>
    <div *ngIf="isEnterpriseEdition"
         [matTooltip]="getTooltip(view.KyvernoPolicies)"
         [ngClass]="{'km-disabled': !isDisabledField(view.KyvernoPolicies)}"
         class="menu-item">
      <a id="km-nav-item-cluster-templates"
         fxLayoutAlign=" center"
         fxLayoutGap="20px"
         [routerLink]="getRouterLink(view.KyvernoPolicies)"
         [ngClass]="getLinkClass(view.KyvernoPolicies)">
        <i class="km-icon-kyverno"></i>
        <span *ngIf="!isSidenavCollapsed">{{ViewDisplayName.KyvernoPolicies}}</span>
      </a>
    </div>

    <km-side-nav-field [label]="projectSidenavSections.Access"
                       icon="km-icon-key"
                       [isSidenavCollapsed]="isSidenavCollapsed"
                       [lastItem]=true>
      <ng-container *ngIf="!isSidenavCollapsed">
        <div *ngIf="isUserSshKeyEnabled"
             [ngClass]="{'active': checkUrl(view.SSHKeys), 'km-disabled': !isDisabledField(view.SSHKeys)}"
             class="sub-menu-item">
          <a id="km-nav-item-sshkeys"
             fxLayoutAlign=" center"
             [routerLink]="getRouterLink(view.SSHKeys)">
            <span>SSH Keys</span>
          </a>
        </div>

        <div [ngClass]="{'active': checkUrl(view.Members), 'km-disabled': !isDisabledField(view.Members)}"
             class="sub-menu-item">
          <a id="km-nav-item-members"
             fxLayoutAlign=" center"
             [routerLink]="getRouterLink(view.Members)">
            <span>Members</span>
          </a>
        </div>

        <div *ngIf="isEnterpriseEdition"
             [ngClass]="{'active': checkUrl(view.Groups), 'km-disabled': !isDisabledField(view.Groups)}"
             class="sub-menu-item">
          <a fxLayoutAlign=" center"
             [routerLink]="getRouterLink(view.Groups)">
            <span>Groups</span>
          </a>
        </div>

        <div [ngClass]="{'active': checkUrl(view.ServiceAccounts), 'km-disabled': !isDisabledField(view.ServiceAccounts)}"
             class="sub-menu-item">
          <a id="km-nav-item-service-accounts"
             fxLayoutAlign=" center"
             [routerLink]="getRouterLink(view.ServiceAccounts)">
            <span>Service Accounts</span></a>
        </div>
      </ng-container>

      <ng-container *ngIf="isSidenavCollapsed">
        <a *ngIf="isUserSshKeyEnabled"
           fxLayoutAlign=" center"
           [routerLink]="getRouterLink(view.SSHKeys)"
           class="collapsed-sub-menu-item"
           [ngClass]="{'active': checkUrl(view.SSHKeys), 'km-disabled': !isDisabledField(view.SSHKeys)}">
          <span>SSH Keys</span>
        </a>

        <a fxLayoutAlign=" center"
           [routerLink]="getRouterLink(view.Members)"
           class="collapsed-sub-menu-item"
           [ngClass]="{'active': checkUrl(view.Members), 'km-disabled': !isDisabledField(view.Members)}">
          <span>Members</span>
        </a>

        <a *ngIf="isEnterpriseEdition"
           fxLayoutAlign=" center"
           [routerLink]="getRouterLink(view.Groups)"
           class="collapsed-sub-menu-item"
           [ngClass]="{'active': checkUrl(view.Groups), 'km-disabled': !isDisabledField(view.Groups)}">
          <span>Groups</span>
        </a>

        <a fxLayoutAlign=" center"
           [routerLink]="getRouterLink(view.ServiceAccounts)"
           class="collapsed-sub-menu-item"
           [ngClass]="{'active': checkUrl(view.ServiceAccounts), 'km-disabled': !isDisabledField(view.ServiceAccounts)}">
          <span>Service Accounts</span></a>
      </ng-container>

    </km-side-nav-field>

    <ng-container *ngIf="(adminSettings.customLinks| kmLinkLocation: 'Default') as filtered">
      <mat-divider *ngIf="filtered.length > 0"></mat-divider>

      <div *ngFor="let link of filtered"
           class="menu-item">
        <a [href]="link.url"
           fxLayoutAlign=" center"
           fxLayoutGap="20px"
           target="_blank"
           [matTooltip]="link.label"
           [matTooltipDisabled]="!isSidenavCollapsed"
           rel="noopener">
          <i [ngStyle]="getCustomLinkIconStyle(link)"></i>
          <span *ngIf="!isSidenavCollapsed">{{link.label}}</span>
        </a>
      </div>
    </ng-container>

    <div fxFlex></div>

    <div [matTooltip]="getTooltip(view.Projects)"
         class="go-back"
         [ngClass]="{'go-back-collapsed': isSidenavCollapsed}">
      <a id="km-nav-item-projects"
         fxLayoutAlign="center center"
         routerLink="/projects">
        <i class="km-icon-mask km-icon-back"></i>
        <span *ngIf="!isSidenavCollapsed">back to projects</span>
      </a>
    </div>
  </div>
</div>
