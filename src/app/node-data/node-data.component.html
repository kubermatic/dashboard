<form [formGroup]="form"
      fxLayout="column">
  <div fxLayout="row"
       fxLayoutGap="16px">
    <mat-form-field class="km-node-deployment-name"
                    [ngClass]="{none: isNameDisabled}">
      <mat-label>Name</mat-label>
      <input id="km-node-name-input"
             matInput
             formControlName="name"
             type="text"
             autocomplete="off">
      <button mat-icon-button
              class="km-randomize-btn"
              matTooltip="Generate name"
              (click)="generateName()"
              *ngIf="!isNameDisabled">
        <i class="km-icon-randomize"></i>
      </button>
      <mat-hint *ngIf="!isNameDisabled">Leave it empty to use server-side generation.</mat-hint>
      <mat-error *ngIf="form.controls.name.hasError('pattern')">
        Name can only contain alphanumeric characters and dashes (a-z, 0-9 and -).
      </mat-error>
    </mat-form-field>
  </div>

  <mat-form-field fxFlex>
    <mat-label>Replicas*</mat-label>
    <input id="km-node-count-input"
           matInput
           formControlName="count"
           type="number"
           min="0"
           autocomplete="off">
    <mat-error *ngIf="form.controls.count.hasError('required')">Number of replicas is required.</mat-error>
    <mat-error *ngIf="form.controls.count.hasError('ipsMissing')">Not enough IPs left. Reduce number of replicas or add more machine networks.</mat-error>
  </mat-form-field>

  <mat-form-field *ngIf="!isInWizard">
    <mat-label>{{getVersionHeadline(cluster.type, true)}}</mat-label>
    <mat-select formControlName="kubelet"
                disableOptionCentering
                panelClass="km-add-dialog-dropdown">
      <mat-option *ngFor="let version of versions"
                  [value]="version">
        {{ version }}
      </mat-option>
    </mat-select>
  </mat-form-field>

  <kubermatic-aws-node-data *ngIf="cluster.spec.cloud.aws"
                            [cloudSpec]="cluster.spec.cloud"
                            [clusterId]="cluster.id"
                            [projectId]="projectId"
                            [seedDCName]="seedDCName"
                            [nodeData]="nodeData"></kubermatic-aws-node-data>


  <kubermatic-digitalocean-node-data *ngIf="cluster.spec.cloud.digitalocean"
                                     [cloudSpec]="cluster.spec.cloud"
                                     [nodeData]="nodeData"
                                     [projectId]="projectId"
                                     [clusterId]="cluster.id"
                                     [seedDCName]="seedDCName"></kubermatic-digitalocean-node-data>

  <kubermatic-openstack-node-data *ngIf="cluster.spec.cloud.openstack"
                                  [cloudSpec]="cluster.spec.cloud"
                                  [nodeData]="nodeData"
                                  [projectId]="projectId"
                                  [clusterId]="cluster.id"
                                  [seedDCName]="seedDCName"></kubermatic-openstack-node-data>

  <kubermatic-packet-node-data *ngIf="cluster.spec.cloud.packet"
                               [cloudSpec]="cluster.spec.cloud"
                               [projectId]="projectId"
                               [clusterId]="cluster.id"
                               [nodeData]="nodeData"
                               [seedDCName]="seedDCName"></kubermatic-packet-node-data>

  <kubermatic-hetzner-node-data *ngIf="cluster.spec.cloud.hetzner"
                                [cloudSpec]="cluster.spec.cloud"
                                [nodeData]="nodeData"
                                [projectId]="projectId"
                                [clusterId]="cluster.id"
                                [seedDCName]="seedDCName"></kubermatic-hetzner-node-data>

  <kubermatic-vsphere-node-data *ngIf="cluster.spec.cloud.vsphere"
                                [cloudSpec]="cluster.spec.cloud"
                                [clusterId]="cluster.id"
                                [nodeData]="nodeData"></kubermatic-vsphere-node-data>

  <kubermatic-kubevirt-node-data *ngIf="cluster.spec.cloud.kubevirt"
                                 [cloudSpec]="cluster.spec.cloud"
                                 [clusterId]="cluster.id"
                                 [nodeData]="nodeData"></kubermatic-kubevirt-node-data>

  <kubermatic-azure-node-data *ngIf="cluster.spec.cloud.azure"
                              [cloudSpec]="cluster.spec.cloud"
                              [nodeData]="nodeData"
                              [projectId]="projectId"
                              [clusterId]="cluster.id"
                              [seedDCName]="seedDCName"></kubermatic-azure-node-data>

  <kubermatic-gcp-node-data *ngIf="cluster.spec.cloud.gcp"
                            [cloudSpec]="cluster.spec.cloud"
                            [clusterId]="cluster.id"
                            [projectId]="projectId"
                            [seedDCName]="seedDCName"
                            [nodeData]="nodeData"></kubermatic-gcp-node-data>

  <mat-button-toggle-group group="operatingSystemGroup"
                           formControlName="operatingSystem">
    <mat-button-toggle value="ubuntu"
                       *ngIf="!isClusterOpenshift()">
      <i class="km-os-image-ubuntu"></i>
      Ubuntu
    </mat-button-toggle>
    <mat-button-toggle value="centos">
      <i class="km-os-image-centos"></i>
      CentOS
    </mat-button-toggle>
    <mat-button-toggle value="containerLinux"
                       *ngIf="!cluster.spec.cloud.hetzner && !isClusterOpenshift()">
      <i class="km-os-image-container-linux"></i>
      Container Linux
    </mat-button-toggle>
  </mat-button-toggle-group>

</form>

<form [formGroup]="operatingSystemForm"
      fxLayout="column">
  <div fxFlex="100%">
    <!-- Options for Ubuntu -->
    <div *ngIf="form.controls.operatingSystem.value === 'ubuntu'"
         class="km-os-options"
         [ngClass]="(cluster.spec.cloud.openstack || cluster.spec.cloud.vsphere) ? 'km-with-margin' : ''">
      <mat-checkbox id="distUpgradeOnBootUbuntu"
                    formControlName="distUpgradeOnBootUbuntu">Upgrade system on first boot</mat-checkbox>
    </div>

    <!-- Options for CentOS -->
    <div *ngIf="form.controls.operatingSystem.value === 'centos'"
         class="km-os-options"
         [ngClass]="(cluster.spec.cloud.openstack || cluster.spec.cloud.vsphere) ? 'km-with-margin' : ''">
      <mat-checkbox id="distUpgradeOnBootCentos"
                    formControlName="distUpgradeOnBootCentos">Upgrade system on first boot</mat-checkbox>
    </div>

    <!-- Options for Container Linux -->
    <div *ngIf="form.controls.operatingSystem.value === 'containerLinux'"
         class="km-os-options"
         [ngClass]="(cluster.spec.cloud.openstack || cluster.spec.cloud.vsphere) ? 'km-with-margin' : ''">
      <mat-checkbox id="disableAutoUpdate"
                    formControlName="disableAutoUpdate">Disable auto-update</mat-checkbox>
    </div>
  </div>
</form>

<form [formGroup]="nodeDataForm">
  <div class="km-os-options">
    <mat-checkbox id="dynamicConfig"
                  formControlName="dynamicConfig">Dynamic kubelet config</mat-checkbox>
  </div>
</form>

<!-- Extended Node Options -->
<ng-container *ngIf="!isInWizard">
  <kubermatic-node-data-options [nodeData]="nodeData"
                                [cloudSpec]="cluster.spec.cloud"
                                [isInWizard]="isInWizard"></kubermatic-node-data-options>
</ng-container>

<!-- Node Labels & Taints -->
<km-label-form title="Node Labels"
               [(labels)]="nodeData.spec.labels"
               [asyncKeyValidators]=asyncLabelValidators
               [ngClass]="!isInWizard ? 'km-form-in-node-modal' : ''"></km-label-form>

<km-taint-form title="Node Taints"
               [(taints)]="nodeData.spec.taints"
               [ngClass]="!isInWizard ? 'km-form-in-node-modal' : ''"></km-taint-form>
