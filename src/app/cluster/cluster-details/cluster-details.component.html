<ng-container *ngIf="isLoaded()">
  <div fxLayout
       class="km-cluster-detail-actions">
    <div fxFlex="100%"
         align="right">

      <button id="km-delete-cluster-btn"
              mat-flat-button
              color="tertiary"
              (click)="deleteClusterDialog()"
              [disabled]="!isDeleteEnabled()">
        Delete
      </button>
      <div fxFlex></div>
      <button mat-flat-button
              color="alternative"
              (click)="addNode()"
              [fxHide]="nodeDc?.spec?.provider === 'bringyourown'"
              [disabled]="!isAddNodeDeploymentsEnabled()">

        Add Node Deployment
      </button>
      <button class="km-connect-kubeconfig-btn"
              (click)="connectClusterDialog()"
              mat-flat-button
              [disabled]="!!clusterHealthStatus && (clusterHealthStatus.css !== 'km-status-running')">
        Connect
      </button>
      <button class="km-share-kubeconfig-btn"
              (click)="shareConfigDialog()"
              mat-flat-button
              [disabled]="!!clusterHealthStatus && (clusterHealthStatus.css !== 'km-status-running')"
              *ngIf="!!config.share_kubeconfig">
        Share
      </button>
      <a class="km-download-kubeconfig-btn"
         mat-flat-button
         disabled="{{ !isClusterRunning }}"
         href="{{getDownloadURL()}}"
         target="_blank">
        Download Config
      </a>
    </div>
  </div>


  <mat-card class="white km-cluster-details">
    <mat-card-header class="km-card-main-header">
      <mat-card-title class="km-cluster-name">
        <span ngxClipboard
              [cbContent]="cluster.name"
              matTooltip="Click to copy"
              class="km-copy">{{cluster.name}}</span>
        <i [matTooltip]="!!clusterHealthStatus ? clusterHealthStatus.message : ''"
           [ngClass]="!!clusterHealthStatus ? clusterHealthStatus.color : ''"
           class="km-cluster-health"></i>
      </mat-card-title>

      <div class="km-provider-menu">
        <button mat-icon-button
                class="km-provider-menu-btn"
                [matMenuTriggerFor]="menu"
                *ngIf="!cluster.spec.cloud.bringyourown">
          <mat-icon>more_vert</mat-icon>
        </button>
        <mat-menu #menu="matMenu"
                  class="km-provider-edit-settings">
          <button mat-menu-item
                  (click)="editProviderSettings()"
                  [disabled]="!isEditEnabled()">

            <mat-icon class="km-icon-edit"></mat-icon>
            <span>Edit Settings</span>
          </button>
          <button mat-menu-item
                  (click)="editSSHKeys()"
                  [disabled]="!isSSHKeysEditEnabled()">

            <mat-icon class="km-icon-edit"></mat-icon>
            <span>Manage SSH keys</span>
          </button>
        </mat-menu>
      </div>
    </mat-card-header>
    <mat-card-content fxLayout="row wrap"
                      class="km-row">

      <div class="km-content-wrap">

        <km-property>
          <div key>Type</div>
          <div value>
            <span class="km-cluster-type"
                  [matTooltip]="getType(cluster.type)">
              <i class="km-icon-{{cluster.type}}"></i>
            </span>
          </div>
        </km-property>

        <km-property>
          <div key>{{getVersionHeadline(cluster.type, false)}}</div>
          <div value
               fxLayoutGap="4px">
            <span *ngIf="isClusterRunning && (updatesAvailable || downgradesAvailable)"
                  (click)="changeClusterVersionDialog()"
                  matTooltip="Click to change the version"
                  class="km-copy">{{cluster.spec.version}}
              <i *ngIf="updatesAvailable"
                 class="fa fa-arrow-up"></i>
            </span>
            <i *ngIf="someUpgradesRestrictedByKubeletVersion"
               matTooltip="Some Kubernetes versions are not available due to incompatible nodes running in the cluster. Upgrade or recreate your nodes before you can upgrade your cluster to the latest version."
               class="fa fa-exclamation-triangle orange"></i>
            <span *ngIf="!isClusterRunning || !(updatesAvailable || downgradesAvailable)">
              {{cluster.spec.version}}
            </span>
          </div>
        </km-property>

        <km-property>
          <div key>Cluster ID</div>
          <div value
               ngxClipboard
               [cbContent]="cluster.id"
               matTooltip="Click to copy"
               class="km-copy">
            {{cluster.id}}
          </div>
        </km-property>

        <km-property>
          <div key>Provider</div>
          <div value>
            <span class="km-provider-logo km-provider-logo-{{getProvider(nodeDc?.spec?.provider)}}"></span>
          </div>
        </km-property>

        <km-property *ngIf="nodeDc?.spec?.provider !== 'bringyourown'">
          <div key>Region</div>
          <div value>{{nodeDc?.spec?.country}}, {{nodeDc?.spec?.location}}</div>
        </km-property>

        <km-property>
          <div key>
            <span>SSH Keys&nbsp;</span>
            <span matTooltip="You can login into the nodes with the user 'root', 'ubuntu' or 'core'.">
              <i class="fa fa-question-circle"
                 aria-hidden="true"></i>
            </span>
          </div>
          <div value>
            <span *ngFor="let key of sshKeys.slice(0, displayedSSHKeys); let last = last">
              <span>{{key.name}}</span>
              <span *ngIf="!last">,&nbsp;</span>
            </span>
            <ng-container *ngIf="sshKeys.length > displayedSSHKeys">
              <span>...&nbsp;</span>
              <span [matTooltip]="getTruncatedSSHKeys()"
                    class="km-ssh-keys-more">+{{sshKeys.length - displayedSSHKeys}}
              </span>
            </ng-container>
            <span *ngIf="sshKeys.length < 1">-</span>
          </div>
        </km-property>

      </div>
    </mat-card-content>
    <kubermatic-cluster-secrets [cluster]="cluster"
                                [datacenter]="datacenter"
                                [health]="health"></kubermatic-cluster-secrets>
  </mat-card>

  <div class="km-pre-card-title">Node Deployments</div>
  <kubermatic-node-deployment-list [cluster]="cluster"
                                   [nodeDeployments]="nodeDeployments"
                                   (changeNodeDeployment)="reloadClusterNodes()"
                                   [datacenter]="datacenter"
                                   [projectID]="projectID"
                                   [clusterHealthStatus]="clusterHealthStatus"
                                   [isClusterRunning]="isClusterRunning"
                                   [isNodeDeploymentLoadFinished]="isNodeDeploymentLoadFinished"></kubermatic-node-deployment-list>

  <div *ngIf="nodes.length > 0">
    <div class="km-pre-card-title">
      <ng-container>Nodes&nbsp;</ng-container>
      <span matTooltip="Single Node management is being deprecated in favour of Node Deployments. This table displays only the Nodes that are not controlled by other resources (i.e. children of Node Deployment).">
        <i class="fa fa-warning"
           aria-hidden="true"></i>
      </span>
    </div>
    <kubermatic-node-list [cluster]="cluster"
                          [nodes]="nodes"
                          (deleteNode)="reloadClusterNodes()"
                          [datacenter]="datacenter"
                          [projectID]="projectID"
                          [clusterHealthStatus]="clusterHealthStatus"
                          [isClusterRunning]="isClusterRunning"></kubermatic-node-list>
  </div>

  <div class="km-pre-card-title">Events</div>
  <km-event-list [events]="events"></km-event-list>

</ng-container>

<div *ngIf="!isLoaded()">
  <mat-spinner color="accent"
               class="km-spinner"></mat-spinner>
</div>
