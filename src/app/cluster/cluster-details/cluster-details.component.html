<ng-container *ngIf="isLoaded()">
  <div fxLayout class="cluster-detail-actions">
    <div fxFlex="100%" align="right">
      <button class="add-node-btn"
              mat-raised-button color="primary"
              (click)="addNode()"
              [disabled]="!isClusterRunning"
              [fxHide]="nodeDc.spec.provider === 'bringyourown'"
              [disabled]="!!userGroup && !userGroupConfig[userGroup].nodes.create">
          <i class="fa fa-plus" style="margin-right: 5px;" aria-hidden="true"></i>
          Add Node
      </button>
      <button class="connect-kubeconfig-btn" (click)="connectClusterDialog()" mat-button mat-raised-button color="primary" [disabled]="this.clusterHealthClass !== 'statusRunning'">
        Connect
      </button>
      <button class="share-kubeconfig-btn" (click)="shareConfigDialog()" mat-button mat-raised-button color="primary" [disabled]="this.clusterHealthClass !== 'statusRunning'" *ngIf="!!config.share_kubeconfig">
        Share config
      </button>
      <a class="download-kubeconfig-btn" mat-button mat-raised-button disabled="{{ !isClusterRunning }}" color="primary" href="{{ getDownloadURL() }}" target="_blank">Download config</a>
      <button mat-button (click)="deleteClusterDialog()" mat-raised-button [disabled]="!!userGroup && !userGroupConfig[userGroup].clusters.delete">
        <i class="fa fa-trash-o" aria-hidden="true" style="margin-right: 5px;"></i>
        Delete Cluster
      </button>
    </div>
  </div>

  <mat-card class="white" [ngClass]="clusterHealthClass">
    <mat-card-header class="km-card-main-header">
      <mat-card-title>
        <span ngxClipboard [cbContent]="cluster.name" matTooltip="click to copy" class="copy cluster-name">{{cluster.name}}</span>
        <kubermatic-cluster-health-status [cluster]="cluster" [datacenter]="datacenter" [projectID]="projectID"></kubermatic-cluster-health-status>
      </mat-card-title>
    </mat-card-header>
    <!-- <mat-card-subtitle *ngIf="cluster.spec.pause" fxLayout >
      <div fxFlex>
        <p class="pauseReason">{{cluster.spec.pauseReason}}</p>
      </div>
    </mat-card-subtitle> -->
    <mat-card-content fxLayout class="row">
      <div fxFlex="20%">
        <strong>Master Version:</strong>
      </div>
      <div fxFlex="35%" class="change-version" *ngIf="isClusterRunning && (updatesAvailable || downgradesAvailable)">
        <span (click)="changeClusterVersionDialog()" matTooltip="click to change version" class="copy">{{cluster.spec.version}}
        <small [hidden]="!updatesAvailable">upgrade available</small></span>
      </div>
      <div fxFlex="35%" class="change-version" [hidden]="isClusterRunning && (updatesAvailable || downgradesAvailable)">
        {{cluster.spec.version}}
      </div>
    </mat-card-content>
  </mat-card>
  <kubermatic-cluster-secrets [cluster]="cluster" [datacenter]="datacenter" [projectID]="projectID" [userGroup]="userGroup"></kubermatic-cluster-secrets>

  <mat-card class="blue">
    <mat-card-header >
      <mat-card-title fxLayout>
        <div fxFlex="42%">Provider</div>
        <div fxFlex="30%">Node Region</div>
        <div fxFlex="25%">
          SSH keys
          <span class="km-card-ssh-tooltip" matTooltip="You can login into the nodes with the user 'root', 'ubuntu' or 'core'.">
            <i class="fa fa-question-circle" aria-hidden="true"></i>
          </span>
        </div>
        <div fxFlex="3%" class="provider-menu">
          <button mat-icon-button class="km-provider-menu-btn" [matMenuTriggerFor]="menu" *ngIf="!cluster.spec.cloud.bringyourown">
            <mat-icon>more_vert</mat-icon>
          </button>
          <mat-menu #menu="matMenu" class="km-provider-edit-settings">
            <button mat-menu-item (click)="editProviderSettings()" [disabled]="!!userGroup && !userGroupConfig[userGroup].clusters.edit">
              <mat-icon class="iconEdit black"></mat-icon>
              <span>Edit Settings</span>
            </button>
            <button mat-menu-item (click)="editSSHKeys()" [disabled]="!!userGroup && !userGroupConfig[userGroup].sshKeys.edit">
              <mat-icon class="iconEdit black"></mat-icon>
              <span>Manage SSH keys</span>
            </button>
          </mat-menu>
        </div>
      </mat-card-title>
    </mat-card-header>

    <mat-card-content>
      <div class="row" fxLayout>
        <div fxFlex="42%">
          <img src="/assets/images/clouds/{{nodeDc.spec.provider}}.png" class="provider-logo" alt="Cluster Icon" />
        </div>
        <div fxFlex="30%" class="region">
          <ng-container *ngIf="nodeDc.spec.provider !== 'bringyourown'">
            <span class="{{'flag-icon flag-icon-' + nodeDc.spec.country.toLowerCase()}}"></span>
            <span class="location">{{nodeDc.spec.country}} / {{nodeDc.spec.location}}</span>
          </ng-container>
        </div>
        <div fxFlex="25%">
          <ng-container [ngSwitch]="sshKeys.length > 0">
            <ul class="km-ssh-keys-list"  *ngSwitchCase="true">
              <li *ngFor="let key of sshKeys.slice(0, 3)">
                <i class="fa fa-key"></i>
                {{key.name}}
              </li>
              <div class="km-ssh-keys-list-more" *ngIf="sshKeys.length > 3">
                <div class="km-more-sshKeys-btn" (click)="loadMoreSshKeys(true)" *ngIf="!moreSshKeys">
                  <strong>More</strong>
                  <span class="iconArrowDown"></span>
                </div>
                <div class="km-more-sshKeys" *ngIf="moreSshKeys">
                  <li *ngFor="let key of sshKeys.slice(3, sshKeys.length+1)">
                    <i class="fa fa-key"></i>
                    {{key.name}}
                  </li>
                </div>
                <div class="km-more-sshKeys-btn" (click)="loadMoreSshKeys(false)" *ngIf="moreSshKeys">
                  <strong>Less</strong>
                  <span class="iconArrowUp"></span>
                </div>
              </div>
              <!-- <div fxFlex="3%"></div>-->
            </ul>
          </ng-container>
        </div>
      </div>
    </mat-card-content>
  </mat-card>

  <kubermatic-node-list [cluster]="cluster" [nodes]="nodes" (deleteNode)="reloadClusterNodes()" [datacenter]="datacenter" [projectID]="projectID" [clusterHealthStatus]="clusterHealthClass" [isClusterRunning]="isClusterRunning" [hasInitialNodes]="hasInitialNodes"></kubermatic-node-list>

  <div style="margin-bottom: 70px;"></div>
</ng-container>

<div *ngIf="!isLoaded()">
  <mat-spinner color="accent" class="km-spinner"></mat-spinner>
</div>
